<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife: Forest Runner</title>
    <style>
        :root { --glow: #00ff41; --dim: #003b00; --bg: #050505; --text: #00ff41; --panel: rgba(0, 20, 0, 0.9); --border: #00ff41; --error: #ff3333; }
        .theme-white { --glow: #007bff; --dim: #e7f1ff; --bg: #ffffff; --text: #333333; --panel: #f1f1f1; --border: #007bff; }
        body, html { margin: 0; padding: 0; min-height: 100vh; background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; transition: 0.3s; overflow-x: hidden; }
        body::after { content: " "; display: block; position: fixed; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.1) 50%); z-index: 9999; background-size: 100% 3px; pointer-events: none; }
        
        /* NAV & GAME ICON */
        #forest-nav { position: fixed; top: 15px; left: 15px; z-index: 9000; cursor: pointer; font-size: 35px; filter: drop-shadow(0 0 5px var(--glow)); }
        #game-trigger { position: fixed; top: 15px; right: 15px; z-index: 9000; cursor: pointer; font-size: 35px; filter: drop-shadow(0 0 5px var(--glow)); }

        #command-center { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9001; align-items: center; justify-content: center; }
        .menu-box { background: var(--bg); border: 2px solid var(--border); padding: 25px; width: 95%; max-width: 500px; display: flex; flex-direction: column; gap: 6px; }
        .module-window { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 9005; padding: 40px 20px; overflow-y: auto; }
        .close-mod { position: absolute; top: 15px; right: 25px; font-size: 30px; cursor: pointer; color: var(--error); }
        
        #feed { max-width: 600px; margin: 80px auto; padding: 10px; }
        .card { border: 1px solid var(--border); margin-bottom: 30px; background: var(--panel); padding: 15px; }
        input, textarea { background: #000; border: 1px solid var(--dim); color: var(--glow); padding: 12px; width: 100%; box-sizing: border-box; font-family: inherit; margin: 5px 0; }
        .btn { border: 1px solid var(--border); background: transparent; color: var(--text); padding: 10px; cursor: pointer; text-transform: uppercase; font-weight: bold; font-size: 0.75rem;}
        .btn:hover { background: var(--border); color: #000; }

        /* GAME ENGINE STYLES */
        #game-canvas-container { display: none; flex-direction: column; align-items: center; justify-content: center; position: fixed; inset: 0; background: #000; z-index: 11000; }
        #game-screen { border: 2px solid var(--glow); background: #050505; cursor: none; }
        .game-ui { margin-top: 10px; text-align: center; }
    </style>
</head>
<body>

<audio id="bgMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg"></audio>

<div id="forest-nav" onclick="openMenu()">üå≤</div>
<div id="game-trigger" onclick="toggleGame()">üéÆ</div>

<div id="game-canvas-container">
    <span class="close-mod" onclick="toggleGame()">√ó</span>
    <h2 id="game-title">[ FOREST_RUNNER_V1 ]</h2>
    <canvas id="game-screen" width="400" height="200"></canvas>
    <div class="game-ui">
        <p id="game-tutorial">TUTORIAL: Click/Tap Screen to JUMP. Avoid the Red Hackers ('X').</p>
        <h3 id="score-val">SCORE: 0</h3>
        <button class="btn" id="start-btn" onclick="startGame()">START_SIMULATION</button>
    </div>
</div>

<div id="command-center">
    <div class="menu-box">
        <h2 style="text-align:center;">[ FOREST_OS_V5.4 ]</h2>
        <button class="btn" onclick="openMod('dm-mod')">1. [DMs] MESSAGES</button>
        <button class="btn" onclick="openMod('create-forest-mod')">2. [NEW FOREST] CREATE</button>
        <button class="btn" onclick="openMod('search-mod')">3. [SEARCH] USERS / REQS</button>
        <button class="btn" onclick="openMod('friends-mod')">4. [FRIENDS] CONTACTS</button>
        <button class="btn" onclick="openMod('self-mod')">5. [PROFILE] SELF</button>
        <button class="btn" onclick="openMod('other-mod')">6. [RECON] SCAN</button>
        <button class="btn" onclick="openMod('settings-mod')">7. [SETTINGS] STATS</button>
        <button class="btn" onclick="openMod('search-forest-mod')">8. [EXPLORE] COMMUNITIES</button>
        <button class="btn" onclick="closeMenu()" style="border-color:gray; color:gray;">[ CLOSE ]</button>
    </div>
</div>

<div id="dm-mod" class="module-window"><span class="close-mod" onclick="closeMod('dm-mod')">√ó</span><h3>[ DMs ]</h3><input id="dm-target" placeholder="User..."><textarea id="dm-text" placeholder="Message..."></textarea><button class="btn" onclick="sendDM()">SEND</button><div id="dm-list"></div></div>
<div id="create-forest-mod" class="module-window"><span class="close-mod" onclick="closeMod('create-forest-mod')">√ó</span><h3>[ NEW FOREST ]</h3><input id="f-name" placeholder="Name..."><button class="btn" onclick="createForest()">CREATE</button></div>
<div id="search-mod" class="module-window"><span class="close-mod" onclick="closeMod('search-mod')">√ó</span><h3>[ USERS ]</h3><div id="pending-requests" class="request-box" style="display:none;"><div id="req-list"></div></div><input id="search-input" oninput="doSearch()"><div id="search-results"></div></div>
<div id="friends-mod" class="module-window"><span class="close-mod" onclick="closeMod('friends-mod')">√ó</span><h3>[ CONTACTS ]</h3><div id="friends-list"></div></div>
<div id="self-mod" class="module-window"><span class="close-mod" onclick="closeMod('self-mod')">√ó</span><h3>[ PROFILE ]</h3><div id="self-data"></div><textarea id="bio-input"></textarea><button class="btn" onclick="saveBio()">SAVE</button></div>
<div id="other-mod" class="module-window"><span class="close-mod" onclick="closeMod('other-mod')">√ó</span><h3>[ RECON ]</h3><input id="recon-target"><button class="btn" onclick="reconUser()">SCAN</button><div id="recon-result"></div></div>
<div id="settings-mod" class="module-window"><span class="close-mod" onclick="closeMod('settings-mod')">√ó</span><h3>[ SYSTEM ]</h3><button class="btn" onclick="toggleTheme()">THEME</button><div id="stats-area"></div></div>
<div id="search-forest-mod" class="module-window"><span class="close-mod" onclick="closeMod('search-forest-mod')">√ó</span><h3>[ EXPLORE ]</h3><input id="forest-search-input" oninput="doForestSearch()"><div id="forest-search-results"></div></div>

<div id="auth-screen"><div class="menu-box"><h2>WILDLIFE_V5.4</h2><input id="u" placeholder="U"><input id="p" type="password" placeholder="P"><div id="signup-extra"><input id="d" type="date"></div><button class="btn" onclick="handleAuth()">ENTER</button></div></div>

<div id="main-ui" style="display:none;"><div id="feed"></div></div>
<button style="position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; border:1px solid var(--border); background:#000; color:var(--text); cursor:pointer; font-size:30px;" onclick="addPost()">+</button>

<script>
    const BIN_ID = '69609cd1ae596e708fcf605f', KEY = '$2a$10$sGFP1dkFd/v7sGKtbL3XLOYw0jsKRMUNIgsTU/iwij0XnwUAeJPWy';
    let db = { posts: [], accounts: [], dms: [], forests: [] }, me = null, sessionStart = Date.now();

    // GAME ENGINE
    const canvas = document.getElementById('game-screen');
    const ctx = canvas.getContext('2d');
    let gameActive = false, score = 0, playerY = 150, playerJump = false, jumpForce = 0, obstacles = [];

    function toggleGame() {
        const container = document.getElementById('game-canvas-container');
        container.style.display = container.style.display === 'flex' ? 'none' : 'flex';
        if(container.style.display === 'none') gameActive = false;
    }

    function startGame() {
        if(gameActive) return;
        gameActive = true; score = 0; obstacles = []; playerY = 150;
        document.getElementById('start-btn').style.display = 'none';
        gameLoop();
    }

    canvas.addEventListener('mousedown', () => { if(playerY >= 150) { playerJump = true; jumpForce = 12; } });

    function gameLoop() {
        if(!gameActive) return;
        ctx.clearRect(0, 0, 400, 200);
        
        // Player
        if(playerJump) { playerY -= jumpForce; jumpForce -= 0.6; if(playerY >= 150) { playerY = 150; playerJump = false; } }
        ctx.fillStyle = "#00ff41";
        ctx.fillText(" (O_O) ", 20, playerY);
        ctx.fillText(" /| |\\ ", 20, playerY + 10);

        // Obstacles
        if(Math.random() < 0.02) obstacles.push({ x: 400, y: 160 });
        obstacles.forEach((o, i) => {
            o.x -= 5;
            ctx.fillStyle = "red";
            ctx.fillText("[X]", o.x, o.y);
            // Collision
            if(o.x < 50 && o.x > 10 && playerY > 130) {
                gameActive = false;
                alert("SYSTEM_CRASHED | SCORE: " + score);
                document.getElementById('start-btn').style.display = 'block';
            }
        });
        obstacles = obstacles.filter(o => o.x > -20);
        
        score++;
        document.getElementById('score-val').innerText = "SCORE: " + score;
        requestAnimationFrame(gameLoop);
    }

    // SOCIAL LOGIC
    const AI_SHIELD = (t) => !["badword", "bully", "mean", "hate", "inappropriate"].some(w => t.toLowerCase().includes(w));
    async function sync() { const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: {'X-Master-Key': KEY, 'X-Bin-Meta': 'false'}}); db = await r.json(); }
    async function save() { await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers: {'Content-Type': 'application/json', 'X-Master-Key': KEY}, body: JSON.stringify(db)}); }

    async function handleAuth() {
        const user = document.getElementById('u').value.trim(), pass = document.getElementById('p').value;
        await sync();
        me = db.accounts.find(a => a.user === user && a.pass === pass) || { user, pass, bio: "User.", friends: [], requests: [], joined: Date.now(), totalTime: 0 };
        if(!db.accounts.find(a => a.user === user)) db.accounts.push(me);
        localStorage.setItem('jungle_v5.4', JSON.stringify(me)); location.reload();
    }

    window.openMenu = () => { document.getElementById('command-center').style.display='flex'; }
    window.closeMenu = () => { document.getElementById('command-center').style.display='none'; }
    window.openMod = (id) => { 
        closeMenu(); document.querySelectorAll('.module-window').forEach(w => w.style.display='none');
        document.getElementById(id).style.display='block'; 
        if(id === 'search-mod') renderSearch();
        if(id === 'dm-mod') renderDMs();
        if(id === 'friends-mod') renderFriends();
        if(id === 'search-forest-mod') renderForestsList();
        if(id === 'self-mod') { document.getElementById('self-data').innerHTML = `<b>${me.user}</b>`; document.getElementById('bio-input').value = me.bio; }
        if(id === 'settings-mod') renderStats();
    }
    window.closeMod = (id) => { document.getElementById(id).style.display='none'; }

    window.createForest = async () => { const n = document.getElementById('f-name').value; if(AI_SHIELD(n)) { db.forests.push({ name: n, creator: me.user }); await save(); alert("CREATED"); }}
    window.doForestSearch = () => { const v = document.getElementById('forest-search-input').value.toLowerCase(); document.getElementById('forest-search-results').innerHTML = db.forests.filter(f => f.name.toLowerCase().includes(v)).map(f => `<div class="list-item">üå≤ ${f.name}</div>`).join(''); }
    function renderForestsList() { document.getElementById('forest-search-results').innerHTML = db.forests.map(f => `<div class="list-item">üå≤ ${f.name}</div>`).join(''); }
    window.doSearch = () => { const v = document.getElementById('search-input').value.toLowerCase(); document.getElementById('search-results').innerHTML = db.accounts.filter(a => a.user.toLowerCase().includes(v)).map(r => `<div class="list-item">${r.user} <button class="btn" onclick="sendRequest('${r.user}')">REQ</button></div>`).join(''); }
    window.sendRequest = async (n) => { await sync(); db.accounts.find(a => a.user === n).requests.push(me.user); await save(); alert("SENT"); }
    function renderSearch() { const my = db.accounts.find(a => a.user === me.user); if(my.requests.length > 0) { document.getElementById('pending-requests').style.display='block'; document.getElementById('req-list').innerHTML = my.requests.map(n => `<div class="list-item">${n} <button class="btn" onclick="acceptFriend('${n}')">OK</button></div>`).join(''); } }
    window.acceptFriend = async (n) => { await sync(); const m = db.accounts.find(a => a.user === me.user); m.requests = m.requests.filter(x => x !== n); m.friends.push(n); db.accounts.find(a => a.user === n).friends.push(me.user); await save(); location.reload(); }
    window.sendDM = async () => { const t = document.getElementById('dm-target').value, m = document.getElementById('dm-text').value; db.dms.push({ from: me.user, to: t, text: m }); await save(); renderDMs(); }
    function renderDMs() { document.getElementById('dm-list').innerHTML = db.dms.filter(d => d.to === me.user || d.from === me.user).map(d => `<div class="list-item"><b>${d.from}:</b> ${d.text}</div>`).join(''); }
    function renderFriends() { document.getElementById('friends-list').innerHTML = me.friends.map(f => `<div class="list-item">${f}</div>`).join(''); }
    window.saveBio = async () => { db.accounts.find(a => a.user === me.user).bio = document.getElementById('bio-input').value; await save(); alert("SAVED"); }
    window.reconUser = () => { const u = db.accounts.find(x => x.user === document.getElementById('recon-target').value); document.getElementById('recon-result').innerHTML = u ? `<div class="card">${u.user}<br>${u.bio}</div>` : 'ERROR'; }
    function renderStats() { document.getElementById('stats-area').innerHTML = `UPTIME: ${Math.floor((Date.now()-sessionStart)/1000)}s`; }
    window.toggleTheme = () => document.body.classList.toggle('theme-white');
    window.playLaugh = () => new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3').play();

    window.addPost = async () => { const t = prompt("T:"), u = prompt("U:"); if(t && u && AI_SHIELD(t)) { db.posts.unshift({ id: Date.now(), author: me.user, title: t, url: u, comments: [], likes: 0, dislikes: 0, stars: 0 }); await save(); renderFeed(); } }
    window.interact = async (id, type) => { const p = db.posts.find(x => x.id === id); if(type==='like') p.likes++; if(type==='dis') p.dislikes++; if(type==='star') p.stars++; renderFeed(); await save(); }
    window.postComment = async (id, i) => { db.posts.find(x=>x.id===id).comments.push(`${me.user}: ${i.value}`); await save(); i.value=""; renderFeed(); }
    window.erase = async (id) => { if(confirm("ERASE?")) { db.posts = db.posts.filter(p=>p.id!==id); await save(); renderFeed(); } }

    function renderFeed() {
        document.getElementById('feed').innerHTML = db.posts.map(p => `
            <div class="card">
                <small>${p.author}</small> ‚òÖ${p.stars||0}<br>
                <a href="${p.url}" target="_blank" style="color:var(--glow)">‚ñ∂ VIEW</a>
                <h3>${p.title}</h3>
                <button class="btn" onclick="interact(${p.id}, 'like')">üëç ${p.likes||0}</button>
                <button class="btn" onclick="interact(${p.id}, 'dis')">üëé ${p.dislikes||0}</button>
                ${me.user==='mjmc50'?'<button class="btn" style="color:red" onclick="erase('+p.id+')">X</button>':''}
                <input placeholder=".." onkeydown="if(event.key==='Enter') postComment(${p.id}, this)">
                <div style="font-size:0.7rem;">${(p.comments||[]).slice(-2).map(c=>`<div>> ${c}</div>`).join('')}</div>
            </div>`).join('');
    }

    window.onload = async () => {
        const saved = localStorage.getItem('jungle_v5.4');
        if(saved) { me = JSON.parse(saved); document.getElementById('auth-screen').style.display='none'; document.getElementById('main-ui').style.display='block'; await sync(); renderFeed(); }
    }
</script>
</body>
</html>
