<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife: Device Locked</title>
    <style>
        :root { --glow: #00ff41; --dim: #003b00; --bg: #050505; --text: #00ff41; --panel: rgba(0, 20, 0, 0.9); --border: #00ff41; --error: #ff3333; }
        .theme-white { --glow: #007bff; --dim: #e7f1ff; --bg: #ffffff; --text: #333333; --panel: #f1f1f1; --border: #007bff; }
        body, html { margin: 0; padding: 0; min-height: 100vh; background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; transition: 0.3s; overflow-x: hidden; }
        body::after { content: " "; display: block; position: fixed; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.1) 50%); z-index: 9999; background-size: 100% 3px; pointer-events: none; }
        #forest-nav, #game-trigger { position: fixed; top: 15px; z-index: 9000; cursor: pointer; font-size: 35px; filter: drop-shadow(0 0 5px var(--glow)); }
        #forest-nav { left: 15px; } #game-trigger { right: 15px; }
        #command-center { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9001; align-items: center; justify-content: center; }
        .menu-box { background: var(--bg); border: 2px solid var(--border); padding: 25px; width: 95%; max-width: 500px; display: flex; flex-direction: column; gap: 6px; }
        .module-window { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 9005; padding: 40px 20px; overflow-y: auto; }
        .close-mod { position: absolute; top: 15px; right: 25px; font-size: 30px; cursor: pointer; color: var(--error); }
        #feed { max-width: 600px; margin: 80px auto; padding: 10px; }
        .card { border: 1px solid var(--border); margin-bottom: 30px; background: var(--panel); padding: 15px; }
        input, textarea { background: #000; border: 1px solid var(--dim); color: var(--glow); padding: 12px; width: 100%; box-sizing: border-box; font-family: inherit; margin: 5px 0; }
        .btn { border: 1px solid var(--border); background: transparent; color: var(--text); padding: 10px; cursor: pointer; text-transform: uppercase; font-weight: bold; font-size: 0.75rem;}
        .btn:hover { background: var(--border); color: #000; }
        #game-canvas-container { display: none; flex-direction: column; align-items: center; justify-content: center; position: fixed; inset: 0; background: #000; z-index: 11000; }
        #game-screen { border: 2px solid var(--glow); background: #050505; }
    </style>
</head>
<body>

<div id="forest-nav" onclick="openMenu()">üå≤</div>
<div id="game-trigger" onclick="toggleGame()">üéÆ</div>

<div id="auth-screen">
    <div class="menu-box">
        <h2 style="text-align:center;">WILDLIFE_V5.5</h2>
        <p style="font-size:0.7rem; color:orange; text-align:center;">[ WARNING: FIRST DEVICE TO LOGIN OWNS THIS ACCOUNT ]</p>
        <input id="u" placeholder="ENTER USERNAME">
        <div id="signup-extra"><input id="d" type="date"></div>
        <button class="btn" onclick="handleAuth()">ACCESS SYSTEM</button>
    </div>
</div>

<div id="main-ui" style="display:none;"><div id="feed"></div></div>

<div id="command-center">
    <div class="menu-box">
        <h2 style="text-align:center;">[ FOREST_OS ]</h2>
        <button class="btn" onclick="openMod('dm-mod')">1. DMs</button>
        <button class="btn" onclick="openMod('create-forest-mod')">2. NEW FOREST</button>
        <button class="btn" onclick="openMod('search-mod')">3. SEARCH USERS</button>
        <button class="btn" onclick="openMod('friends-mod')">4. FRIENDS</button>
        <button class="btn" onclick="openMod('self-mod')">5. PROFILE</button>
        <button class="btn" onclick="openMod('other-mod')">6. RECON</button>
        <button class="btn" onclick="openMod('settings-mod')">7. SETTINGS</button>
        <button class="btn" onclick="openMod('search-forest-mod')">8. EXPLORE</button>
        <button class="btn" onclick="closeMenu()">CLOSE</button>
    </div>
</div>

<div id="game-canvas-container">
    <span class="close-mod" onclick="toggleGame()">√ó</span>
    <canvas id="game-screen" width="400" height="200"></canvas>
    <button class="btn" id="start-btn" onclick="startGame()">START RUN</button>
</div>

<div id="dm-mod" class="module-window"><span class="close-mod" onclick="closeMod('dm-mod')">√ó</span><h3>[ DMs ]</h3><input id="dm-target" placeholder="User..."><textarea id="dm-text"></textarea><button class="btn" onclick="sendDM()">SEND</button><div id="dm-list"></div></div>
<div id="create-forest-mod" class="module-window"><span class="close-mod" onclick="closeMod('create-forest-mod')">√ó</span><h3>[ CREATE FOREST ]</h3><input id="f-name"><button class="btn" onclick="createForest()">CONFIRM</button></div>
<div id="search-mod" class="module-window"><span class="close-mod" onclick="closeMod('search-mod')">√ó</span><h3>[ SEARCH ]</h3><input id="search-input" oninput="doSearch()"><div id="search-results"></div></div>
<div id="friends-mod" class="module-window"><span class="close-mod" onclick="closeMod('friends-mod')">√ó</span><h3>[ FRIENDS ]</h3><div id="friends-list"></div></div>
<div id="self-mod" class="module-window"><span class="close-mod" onclick="closeMod('self-mod')">√ó</span><h3>[ MY PROFILE ]</h3><div id="self-data"></div><textarea id="bio-input"></textarea><button class="btn" onclick="saveBio()">SAVE</button></div>
<div id="other-mod" class="module-window"><span class="close-mod" onclick="closeMod('other-mod')">√ó</span><h3>[ RECON ]</h3><input id="recon-target"><button class="btn" onclick="reconUser()">SCAN</button><div id="recon-result"></div></div>
<div id="settings-mod" class="module-window"><span class="close-mod" onclick="closeMod('settings-mod')">√ó</span><h3>[ SETTINGS ]</h3><button class="btn" onclick="toggleTheme()">THEME</button><div id="stats-area"></div></div>
<div id="search-forest-mod" class="module-window"><span class="close-mod" onclick="closeMod('search-forest-mod')">√ó</span><h3>[ EXPLORE ]</h3><input id="forest-search-input" oninput="doForestSearch()"><div id="forest-search-results"></div></div>

<script>
    const BIN_ID = '69609cd1ae596e708fcf605f', KEY = '$2a$10$sGFP1dkFd/v7sGKtbL3XLOYw0jsKRMUNIgsTU/iwij0XnwUAeJPWy';
    let db = { posts: [], accounts: [], dms: [], forests: [] }, me = null;

    // DEVICE FINGERPRINT GENERATOR
    function getFingerprint() {
        return navigator.userAgent + (navigator.hardwareConcurrency || '8') + screen.width + screen.height;
    }

    async function sync() { const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: {'X-Master-Key': KEY, 'X-Bin-Meta': 'false'}}); db = await r.json(); }
    async function save() { await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers: {'Content-Type': 'application/json', 'X-Master-Key': KEY}, body: JSON.stringify(db)}); }

    async function handleAuth() {
        const user = document.getElementById('u').value.trim();
        const currentFP = getFingerprint();
        await sync();
        
        let account = db.accounts.find(a => a.user === user);
        
        if (account) {
            // Check if fingerprint matches
            if (account.fingerprint === currentFP) {
                me = account;
            } else {
                return alert("ACCESS_DENIED: THIS ACCOUNT IS LOCKED TO ANOTHER DEVICE.");
            }
        } else {
            // New Account Creation
            const age = Math.floor((new Date() - new Date(document.getElementById('d').value)) / 31557600000);
            if (age < 13 || age > 16) return alert("AGE_GATE_FAILURE");
            me = { user, fingerprint: currentFP, bio: "User.", friends: [], requests: [], joined: Date.now() };
            db.accounts.push(me);
            await save();
        }
        
        localStorage.setItem('jungle_v5.5', JSON.stringify(me));
        location.reload();
    }

    // MENU & SOCIAL LOGIC (Condensed version of V5.4 logic)
    window.openMenu = () => document.getElementById('command-center').style.display='flex';
    window.closeMenu = () => document.getElementById('command-center').style.display='none';
    window.openMod = (id) => { closeMenu(); document.querySelectorAll('.module-window').forEach(w => w.style.display='none'); document.getElementById(id).style.display='block'; if(id === 'search-mod') renderSearch(); if(id === 'dm-mod') renderDMs(); if(id === 'friends-mod') renderFriends(); if(id === 'search-forest-mod') renderForestsList(); if(id === 'self-mod'){ document.getElementById('self-data').innerHTML = me.user; document.getElementById('bio-input').value = me.bio; } }
    window.closeMod = (id) => document.getElementById(id).style.display='none';
    
    // GAME LOGIC
    const canvas = document.getElementById('game-screen'); const ctx = canvas.getContext('2d');
    let gameActive = false, playerY = 150, playerJump = false, jumpForce = 0, obstacles = [];
    function toggleGame() { const c = document.getElementById('game-canvas-container'); c.style.display = c.style.display === 'flex' ? 'none' : 'flex'; gameActive = false; }
    function startGame() { gameActive = true; obstacles = []; playerY = 150; document.getElementById('start-btn').style.display = 'none'; gameLoop(); }
    canvas.addEventListener('mousedown', () => { if(playerY >= 150) { playerJump = true; jumpForce = 12; } });
    function gameLoop() { if(!gameActive) return; ctx.clearRect(0, 0, 400, 200); if(playerJump) { playerY -= jumpForce; jumpForce -= 0.6; if(playerY >= 150) { playerY = 150; playerJump = false; } } ctx.fillStyle = "#00ff41"; ctx.fillText("(O_O)", 20, playerY); if(Math.random() < 0.02) obstacles.push({ x: 400, y: 160 }); obstacles.forEach((o, i) => { o.x -= 5; ctx.fillStyle = "red"; ctx.fillText("[X]", o.x, o.y); if(o.x < 40 && o.x > 10 && playerY > 130) { gameActive = false; alert("CRASH"); document.getElementById('start-btn').style.display = 'block'; } }); obstacles = obstacles.filter(o => o.x > -20); requestAnimationFrame(gameLoop); }

    // FEED & OTHER (Core V5.4 functions truncated for brevity)
    window.addPost = async () => { const t = prompt("T:"), u = prompt("U:"); if(t && u) { db.posts.unshift({ id: Date.now(), author: me.user, title: t, url: u, comments: [], likes: 0, dislikes: 0, stars: 0 }); await save(); renderFeed(); } }
    function renderFeed() { document.getElementById('feed').innerHTML = db.posts.map(p => `<div class="card"><small>${p.author}</small> ‚òÖ${p.stars||0}<br><a href="${p.url}" target="_blank" style="color:var(--glow)">VIEW</a><h3>${p.title}</h3><button class="btn" onclick="interact(${p.id}, 'like')">üëç ${p.likes||0}</button> ${me.user==='mjmc50'?'<button class="btn" style="color:red" onclick="erase('+p.id+')">X</button>':''}</div>`).join(''); }

    window.onload = async () => {
        const saved = localStorage.getItem('jungle_v5.5');
        if(saved) { me = JSON.parse(saved); document.getElementById('auth-screen').style.display='none'; document.getElementById('main-ui').style.display='block'; await sync(); renderFeed(); }
    }
</script>
</body>
</html>
