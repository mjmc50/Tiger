<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife: The Forest Expansion</title>
    <style>
        :root { --glow: #00ff41; --dim: #003b00; --bg: #050505; --text: #00ff41; --panel: rgba(0, 20, 0, 0.9); --border: #00ff41; --error: #ff3333; }
        .theme-white { --glow: #007bff; --dim: #e7f1ff; --bg: #ffffff; --text: #333333; --panel: #f1f1f1; --border: #007bff; }
        body, html { margin: 0; padding: 0; min-height: 100vh; background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; transition: 0.3s; overflow-x: hidden; }
        body::after { content: " "; display: block; position: fixed; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.1) 50%); z-index: 9999; background-size: 100% 3px; pointer-events: none; }
        #forest-nav { position: fixed; top: 15px; left: 15px; z-index: 9000; cursor: pointer; font-size: 35px; filter: drop-shadow(0 0 5px var(--glow)); }
        #command-center { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 9001; align-items: center; justify-content: center; }
        .menu-box { background: var(--bg); border: 2px solid var(--border); padding: 25px; width: 90%; max-width: 500px; display: flex; flex-direction: column; gap: 10px; }
        .menu-btn { border: 1px solid var(--border); background: none; color: var(--text); padding: 12px; cursor: pointer; text-align: left; font-family: inherit; font-weight: bold; }
        .menu-btn:hover { background: var(--glow); color: #000; }
        .module-window { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 9005; padding: 40px 20px; overflow-y: auto; }
        .close-mod { position: absolute; top: 15px; right: 25px; font-size: 30px; cursor: pointer; }
        #feed { max-width: 600px; margin: 80px auto; padding: 10px; }
        .card { border: 1px solid var(--border); margin-bottom: 40px; background: var(--panel); padding: 10px; }
        input, textarea { background: #000; border: 1px solid var(--dim); color: var(--glow); padding: 12px; width: 100%; box-sizing: border-box; font-family: inherit; margin: 5px 0; }
        .btn { border: 1px solid var(--border); background: transparent; color: var(--text); padding: 12px; width: 100%; cursor: pointer; text-transform: uppercase; }
        .btn:hover { background: var(--border); color: #000; }
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .result-item { border: 1px solid var(--dim); padding: 10px; margin-top: 5px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<audio id="bgMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg"></audio>
<div id="forest-nav" onclick="openMenu()">ðŸŒ²</div>

<div id="command-center">
    <div class="menu-box">
        <h2 style="text-align:center;">[ FOREST_OS ]</h2>
        <button class="menu-btn" onclick="openMod('dm-mod')">1. [DMs] MESSAGING</button>
        <button class="menu-btn" onclick="openMod('forest-mod')">2. [FORESTS] SUB-COMMUNITIES</button>
        <button class="menu-btn" onclick="openMod('search-mod')">3. [SEARCH] USER_FINDER</button>
        <button class="menu-btn" onclick="openMod('friends-mod')">4. [FRIENDS] CONTACTS</button>
        <button class="menu-btn" onclick="openMod('self-mod')">5. [PROFILE] MY_IDENTITY</button>
        <button class="menu-btn" onclick="openMod('other-mod')">6. [RECON] VIEW_OTHERS</button>
        <button class="menu-btn" onclick="openMod('settings-mod')">7. [SYSTEM] SETTINGS</button>
        <button class="btn" onclick="closeMenu()">[ CLOSE ]</button>
    </div>
</div>

<div id="dm-mod" class="module-window"><span class="close-mod" onclick="closeMod('dm-mod')">Ã—</span>
    <h3>[ DMs ]</h3>
    <input id="dm-target" placeholder="Recipient Username...">
    <textarea id="dm-text" placeholder="Message..."></textarea>
    <button class="btn" onclick="sendDM()">SEND</button>
    <div id="dm-list" style="margin-top:20px;"></div>
</div>

<div id="forest-mod" class="module-window"><span class="close-mod" onclick="closeMod('forest-mod')">Ã—</span>
    <h3>[ FORESTS ]</h3>
    <input id="f-name" placeholder="New Forest Name...">
    <button class="btn" onclick="createForest()">CREATE_FOREST</button>
    <div id="forest-list" style="margin-top:20px;"></div>
</div>

<div id="search-mod" class="module-window"><span class="close-mod" onclick="closeMod('search-mod')">Ã—</span>
    <h3>[ USER_SEARCH ]</h3>
    <input id="search-input" placeholder="Enter username..." oninput="doSearch()">
    <div id="search-results"></div>
</div>

<div id="friends-mod" class="module-window"><span class="close-mod" onclick="closeMod('friends-mod')">Ã—</span>
    <h3>[ FRIENDS ]</h3>
    <div id="friends-list"></div>
</div>

<div id="self-mod" class="module-window"><span class="close-mod" onclick="closeMod('self-mod')">Ã—</span>
    <h3>[ MY_PROFILE ]</h3>
    <div id="self-data"></div>
    <textarea id="bio-input" placeholder="Write bio..."></textarea>
    <button class="btn" onclick="saveBio()">SAVE_BIO</button>
</div>

<div id="other-mod" class="module-window"><span class="close-mod" onclick="closeMod('other-mod')">Ã—</span>
    <h3>[ RECON ]</h3>
    <input id="recon-target" placeholder="Username to scan...">
    <button class="btn" onclick="reconUser()">SCAN_USER</button>
    <div id="recon-result" style="margin-top:20px;"></div>
</div>

<div id="settings-mod" class="module-window"><span class="close-mod" onclick="closeMod('settings-mod')">Ã—</span>
    <h3>[ SETTINGS ]</h3>
    <button class="btn" onclick="toggleTheme()">TOGGLE_THEME</button>
    <button class="btn" onclick="playLaugh()">LAUGH_PROTOCOL</button>
    <p id="uptime-box"></p>
</div>

<div id="auth-screen">
    <div class="menu-box">
        <h2 style="text-align:center;">WILDLIFE_LOGIN</h2>
        <input id="u" placeholder="USERNAME"><input id="p" type="password" placeholder="PASSWORD">
        <div id="signup-extra"><input id="d" type="date"></div>
        <button class="btn" onclick="handleAuth()">INITIALIZE</button>
        <p onclick="toggleAuth()" style="font-size:0.7rem; text-align:center; cursor:pointer;">Toggle Login/Signup</p>
    </div>
</div>

<div id="main-ui" style="display:none;"><div id="feed"></div></div>
<button class="add-btn" style="position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; border:1px solid var(--glow); background:#000; color:var(--glow); cursor:pointer; font-size:30px;" onclick="addPost()">+</button>

<script>
    const BIN_ID = '69609cd1ae596e708fcf605f';
    const KEY = '$2a$10$sGFP1dkFd/v7sGKtbL3XLOYw0jsKRMUNIgsTU/iwij0XnwUAeJPWy';
    let db = { posts: [], accounts: [], dms: [], forests: [] };
    let me = null;
    let isLogin = false;
    let startTime = Date.now();

    const AI_SHIELD = (t) => !["badword", "bully", "mean"].some(w => t.toLowerCase().includes(w));

    async function sync() {
        const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: {'X-Master-Key': KEY, 'X-Bin-Meta': 'false'}});
        db = await r.json();
    }
    async function save() {
        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers: {'Content-Type': 'application/json', 'X-Master-Key': KEY}, body: JSON.stringify(db)});
    }

    function toggleAuth() { isLogin = !isLogin; document.getElementById('signup-extra').style.display = isLogin ? 'none' : 'block'; }
    
    async function handleAuth() {
        const user = document.getElementById('u').value.trim();
        const pass = document.getElementById('p').value;
        await sync();
        if(isLogin) {
            me = db.accounts.find(a => a.user === user && a.pass === pass);
            if(!me) return alert("FAIL");
        } else {
            const age = Math.floor((new Date() - new Date(document.getElementById('d').value)) / 31557600000);
            if(age < 13 || age > 16) return alert("AGE_GATE");
            me = { user, pass, pfp: 'ðŸ’»', bio: "Empty bio.", friends: [], joined: Date.now() };
            db.accounts.push(me);
            await save();
        }
        localStorage.setItem('jungle_v4', JSON.stringify(me));
        location.reload();
    }

    function openMenu() { document.getElementById('command-center').style.display='flex'; }
    function closeMenu() { document.getElementById('command-center').style.display='none'; }
    
    function openMod(id) { 
        closeMenu(); document.getElementById(id).style.display='block'; 
        if(id === 'dm-mod') renderDMs();
        if(id === 'forest-mod') renderForests();
        if(id === 'friends-mod') renderFriends();
        if(id === 'self-mod') {
            document.getElementById('self-data').innerHTML = `<b>${me.user}</b><br>Joined: ${new Date(me.joined).toLocaleDateString()}`;
            document.getElementById('bio-input').value = me.bio;
        }
    }
    function closeMod(id) { document.getElementById(id).style.display='none'; }

    // 2. FORESTS
    async function createForest() {
        const name = document.getElementById('f-name').value;
        if(!AI_SHIELD(name)) return alert("AI_BLOCKED");
        db.forests.push({ name, creator: me.user });
        await save(); renderForests();
    }
    function renderForests() {
        document.getElementById('forest-list').innerHTML = db.forests.map(f => `<div class="result-item">ðŸŒ² ${f.name} <small>by ${f.creator}</small></div>`).join('');
    }

    // 3. SEARCH
    function doSearch() {
        const val = document.getElementById('search-input').value.toLowerCase();
        const res = db.accounts.filter(a => a.user.toLowerCase().includes(val));
        document.getElementById('search-results').innerHTML = res.map(r => `<div class="result-item">${r.user} <button onclick="addFriend('${r.user}')">+</button></div>`).join('');
    }

    // 4. FRIENDS
    async function addFriend(name) {
        if(name === me.user) return;
        const acc = db.accounts.find(a => a.user === me.user);
        if(!acc.friends.includes(name)) {
            acc.friends.push(name);
            me.friends = acc.friends;
            await save(); alert("ADDED");
        }
    }
    function renderFriends() {
        document.getElementById('friends-list').innerHTML = me.friends.map(f => `<div class="result-item">${f}</div>`).join('');
    }

    // 5. BIO SAVE
    async function saveBio() {
        const b = document.getElementById('bio-input').value;
        if(!AI_SHIELD(b)) return alert("AI_BLOCKED");
        const acc = db.accounts.find(a => a.user === me.user);
        acc.bio = b;
        me.bio = b;
        localStorage.setItem('jungle_v4', JSON.stringify(me));
        await save(); alert("BIO_SAVED");
    }

    // 6. RECON
    function reconUser() {
        const target = document.getElementById('recon-target').value;
        const u = db.accounts.find(a => a.user === target);
        if(!u) return alert("NOT_FOUND");
        document.getElementById('recon-result').innerHTML = `<b>${u.user}</b><br>Bio: ${u.bio}<br>Friends: ${u.friends.length}`;
    }

    async function sendDM() {
        const target = document.getElementById('dm-target').value;
        const msg = document.getElementById('dm-text').value;
        if(!AI_SHIELD(msg)) return alert("AI_BLOCKED");
        db.dms.push({ from: me.user, to: target, text: msg });
        await save(); renderDMs();
    }
    function renderDMs() {
        const list = db.dms.filter(d => d.to === me.user || d.from === me.user);
        document.getElementById('dm-list').innerHTML = list.map(d => `<div><b>${d.from}</b>: ${d.text}</div>`).join('');
    }

    function toggleTheme() { document.body.classList.toggle('theme-white'); }
    function playLaugh() { new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3').play(); }

    async function addPost() {
        const t = prompt("Title:");
        const u = prompt("Drive URL:");
        if(t && u && AI_SHIELD(t)) {
            db.posts.unshift({ author: me.user, title: t, url: u });
            await save(); renderFeed();
        }
    }
    function renderFeed() {
        document.getElementById('feed').innerHTML = db.posts.map(p => `<div class="card"><b>${p.author}</b><br><a href="${p.url}" target="_blank">â–¶ VIEW</a><br>${p.title}</div>`).join('');
    }

    window.onload = async () => {
        const saved = localStorage.getItem('jungle_v4');
        if(saved) {
            me = JSON.parse(saved);
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            await sync();
            renderFeed();
        }
    }
</script>
</body>
</html>
