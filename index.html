<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TigerStream | Search the Jungle</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <style>
        :root { --tiger: #ff8c00; --gold: #ffcc00; --bg-dark: rgba(0,0,0,0.8); }
        body, html { 
            margin: 0; padding: 0; 
            background: url('https://images.unsplash.com/photo-1511497584788-876760111969?auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed; 
            background-size: cover;
            color: #fff; font-family: 'Arial Black', sans-serif; overflow-x: hidden; 
        }
        .forest-overlay { position: fixed; inset: 0; background: var(--bg-dark); backdrop-filter: blur(10px); z-index: -1; }

        /* --- HUB --- */
        #entrance { position: fixed; inset: 0; z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #000; }
        .logo { font-size: clamp(2.5rem, 8vw, 4.5rem); color: var(--tiger); text-shadow: 0 0 20px rgba(255,140,0,0.5); margin-bottom: 30px; }
        .choice-btn { 
            width: 280px; padding: 20px; margin: 10px; border-radius: 50px; 
            border: 3px solid var(--tiger); background: rgba(0,0,0,0.5); color: white; 
            font-size: 1rem; cursor: pointer; transition: 0.3s;
        }
        .choice-btn:hover { background: var(--tiger); color: #000; box-shadow: 0 0 30px var(--tiger); }

        /* --- SEARCH UI --- */
        #search-area { display: none; padding: 100px 20px 20px; text-align: center; }
        .search-bar { width: 90%; max-width: 500px; padding: 15px; border-radius: 30px; border: 2px solid var(--tiger); background: #111; color: white; font-size: 1.1rem; }

        /* --- CONTENT --- */
        .page { display: none; min-height: 100vh; }
        #shorts-page { height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory; }
        .short-card { height: 100vh; width: 100%; scroll-snap-align: start; position: relative; background: #000; }
        .short-card video { width: 100%; height: 100%; object-fit: cover; }
        
        #video-page, #search-results { padding: 100px 20px; }
        .video-item { 
            background: rgba(15,15,15,0.95); border-radius: 25px; margin-bottom: 40px; 
            border: 2px solid var(--tiger); overflow: hidden; max-width: 700px; margin-inline: auto; 
        }
        .video-item video { width: 100%; aspect-ratio: 16/9; display: block; background: #000; }
        
        /* --- UI ELEMENTS --- */
        .ui-box { padding: 20px; border-top: 1px solid #333; }
        .btn-interact { background: #222; border: 1px solid #444; color: white; padding: 8px 15px; border-radius: 10px; cursor: pointer; margin-right: 5px; }
        .stars-container { color: #444; font-size: 1.5rem; }
        .stars-container span.active { color: var(--gold); }
        .fab { position: fixed; bottom: 30px; right: 30px; width: 70px; height: 70px; border-radius: 50%; background: var(--tiger); border: none; font-size: 40px; cursor: pointer; z-index: 2000; }
        .exit-btn { position: fixed; top: 20px; left: 20px; z-index: 2500; background: var(--tiger); color: #000; border: none; padding: 10px 20px; border-radius: 12px; font-weight: bold; cursor: pointer; display: none; }
        
        #uploadModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 4000; align-items: center; justify-content: center; }
        .modal-inner { background: #111; padding: 30px; border-radius: 30px; border: 3px solid var(--tiger); width: 320px; text-align: center; }
    </style>
</head>
<body>

<div class="forest-overlay"></div>

<div id="entrance">
    <div class="logo">üêÖ TIGERSTREAM</div>
    <button class="choice-btn" onclick="openPage('shorts')">SHORTS FEED</button>
    <button class="choice-btn" onclick="openPage('video')">LONG FORM HUB</button>
    <button class="choice-btn" style="border-color: var(--gold);" onclick="openPage('search')">üîç SEARCH THE JUNGLE</button>
</div>

<button class="exit-btn" id="navBack" onclick="location.reload()">‚Üê BACK</button>
<button class="fab" onclick="document.getElementById('uploadModal').style.display='flex'">+</button>

<div id="shorts-page" class="page"></div>
<div id="video-page" class="page"><div id="v-list"></div></div>
<div id="search-area" class="page">
    <input type="text" class="search-bar" placeholder="Type keywords..." oninput="doSearch(this.value)">
    <div id="search-results" style="margin-top:30px;"></div>
</div>

<div id="uploadModal">
    <div class="modal-inner">
        <h2 style="color:var(--tiger)">JUNGLE UPLOAD</h2>
        <input type="file" id="fIn" accept="video/*" onchange="aiScan()">
        <input type="text" id="tIn" placeholder="Title/Keywords...">
        <select id="typeIn" style="width:100%; padding:10px; margin-top:10px; background:#222; color:white; border:none; border-radius:8px;">
            <option value="short">Short</option>
            <option value="video">Long Form</option>
        </select>
        <div id="upStatus" style="font-size:12px; color:var(--gold); margin:15px 0;">Scanning...</div>
        <button id="upBtn" class="choice-btn" style="width:100%; display:none;" onclick="upload()">POST</button>
        <button onclick="document.getElementById('uploadModal').style.display='none'" style="color:gray; background:none; border:none; margin-top:15px; cursor:pointer;">Cancel</button>
    </div>
</div>

<video id="aiHelp" style="display:none;" muted></video>

<script>
    const BIN_ID = '69609cd1ae596e708fcf605f';
    const API_KEY = '$2a$10$sGFP1dkFd/v7sGKtbL3XLOYw0jsKRMUNIgsTU/iwij0XnwUAeJPWy';
    const BANNED = ["fuck", "shit", "bitch", "nigger", "ass", "dick"];

    let hubData = { posts: [] };
    let detector;

    cocoSsd.load().then(m => detector = m);

    async function sync() {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: {'X-Master-Key': API_KEY, 'X-Bin-Meta': 'false'}});
        hubData = await res.json();
    }

    function filter(t) {
        let s = t;
        BANNED.forEach(w => s = s.replace(new RegExp(w, "gi"), "****"));
        return s;
    }

    async function aiScan() {
        const out = document.getElementById('upStatus');
        const file = document.getElementById('fIn').files[0];
        const vid = document.getElementById('aiHelp');
        out.innerText = "üïµÔ∏è AI SCANNING...";
        vid.src = URL.createObjectURL(file);
        vid.onloadeddata = async () => {
            vid.currentTime = 1;
            setTimeout(async () => {
                await detector.detect(vid);
                out.innerText = "‚úÖ SAFE FOR THE JUNGLE";
                document.getElementById('upBtn').style.display = "block";
            }, 1000);
        };
    }

    async function upload() {
        const out = document.getElementById('upStatus');
        const file = document.getElementById('fIn').files[0];
        out.innerText = "üöÄ UPLOADING...";
        const fd = new FormData();
        fd.append('reqtype', 'fileupload');
        fd.append('fileToUpload', file);
        const res = await fetch('https://corsproxy.io/?https://catbox.moe/user/api.php', { method: 'POST', body: fd });
        const url = await res.text();
        if (url.includes('https')) {
            hubData.posts.unshift({
                url, title: filter(document.getElementById('tIn').value),
                type: document.getElementById('typeIn').value,
                likes: 0, dislikes: 0, stars: [], comments: []
            });
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT', headers: {'Content-Type': 'application/json', 'X-Master-Key': API_KEY},
                body: JSON.stringify(hubData)
            });
            location.reload();
        }
    }

    function openPage(m) {
        document.getElementById('entrance').style.display = 'none';
        document.getElementById('navBack').style.display = 'block';
        if(m === 'search') {
            document.getElementById('search-area').style.display = 'block';
        } else {
            document.getElementById(m + '-page').style.display = 'block';
            render(m);
        }
    }

    function doSearch(val) {
        if(!val) return document.getElementById('search-results').innerHTML = "";
        const matches = hubData.posts.filter(p => p.title.toLowerCase().includes(val.toLowerCase()));
        renderContent(matches, document.getElementById('search-results'));
    }

    function render(mode) {
        const target = mode === 'shorts' ? document.getElementById('shorts-page') : document.getElementById('v-list');
        let posts = hubData.posts.filter(p => p.type === mode);
        if(mode === 'video') posts = posts.sort(() => Math.random() - 0.5).slice(0, 4);
        renderContent(posts, target, mode === 'shorts');
    }

    function renderContent(posts, target, isShort = false) {
        target.innerHTML = posts.map(p => `
            <div class="${isShort ? 'short-card' : 'video-item'}">
                <video src="${p.url}" ${isShort?'loop':'controls'} playsinline onclick="this.paused?this.play():this.pause()"></video>
                <div class="ui-box">
                    <h3 style="color:var(--tiger); margin:0 0 10px 0;">${p.title}</h3>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <button class="btn-interact" onclick="stat('${p.url}','likes')">üëç ${p.likes}</button>
                        <button class="btn-interact" onclick="stat('${p.url}','dislikes')">üëé ${p.dislikes}</button>
                    </div>
                </div>
            </div>`).join('');
    }

    async function stat(url, f) {
        const p = hubData.posts.find(x => x.url === url);
        p[f]++; 
        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT', headers: {'Content-Type': 'application/json', 'X-Master-Key': API_KEY},
                body: JSON.stringify(hubData)
        });
        location.reload();
    }

    sync();
</script>
</body>
</html>
