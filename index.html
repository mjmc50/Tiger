<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife: The Forest Expansion</title>
    <style>
        :root { --glow: #00ff41; --dim: #003b00; --bg: #050505; --text: #00ff41; --panel: rgba(0, 20, 0, 0.9); --border: #00ff41; --error: #ff3333; }
        .theme-white { --glow: #007bff; --dim: #e7f1ff; --bg: #ffffff; --text: #333333; --panel: #f1f1f1; --border: #007bff; }
        body, html { margin: 0; padding: 0; min-height: 100vh; background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; transition: 0.3s; overflow-x: hidden; }
        body::after { content: " "; display: block; position: fixed; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.1) 50%); z-index: 9999; background-size: 100% 3px; pointer-events: none; }
        #forest-nav { position: fixed; top: 15px; left: 15px; z-index: 9000; cursor: pointer; font-size: 35px; filter: drop-shadow(0 0 5px var(--glow)); }
        #command-center { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9001; align-items: center; justify-content: center; }
        .menu-box { background: var(--bg); border: 2px solid var(--border); padding: 25px; width: 90%; max-width: 500px; display: flex; flex-direction: column; gap: 10px; }
        .module-window { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 9005; padding: 40px 20px; overflow-y: auto; }
        .close-mod { position: absolute; top: 15px; right: 25px; font-size: 30px; cursor: pointer; }
        #feed { max-width: 600px; margin: 80px auto; padding: 10px; }
        .card { border: 1px solid var(--border); margin-bottom: 40px; background: var(--panel); padding: 15px; }
        input, textarea { background: #000; border: 1px solid var(--dim); color: var(--glow); padding: 12px; width: 100%; box-sizing: border-box; font-family: inherit; margin: 5px 0; }
        .btn { border: 1px solid var(--border); background: transparent; color: var(--text); padding: 10px; cursor: pointer; text-transform: uppercase; font-weight: bold; font-size: 0.7rem; }
        .btn:hover { background: var(--border); color: #000; }
        .stat-line { margin: 10px 0; border-bottom: 1px dashed var(--dim); padding-bottom: 5px; }
        .admin-erase { color: var(--error); border-color: var(--error); margin-top: 10px; }
        .star { color: gold; font-size: 1.2rem; }
    </style>
</head>
<body>

<audio id="bgMusic" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg"></audio>
<div id="forest-nav" onclick="openMenu()">üå≤</div>

<div id="command-center">
    <div class="menu-box">
        <h2 style="text-align:center;">[ FOREST_OS_V5 ]</h2>
        <button class="btn" onclick="openMod('dm-mod')">1. [DMs] MESSAGING</button>
        <button class="btn" onclick="openMod('forest-mod')">2. [FORESTS] COMMUNITIES</button>
        <button class="btn" onclick="openMod('search-mod')">3. [SEARCH] USERS</button>
        <button class="btn" onclick="openMod('friends-mod')">4. [FRIENDS] CONTACTS</button>
        <button class="btn" onclick="openMod('self-mod')">5. [PROFILE] MY_IDENTITY</button>
        <button class="btn" onclick="openMod('other-mod')">6. [RECON] TARGET_SCAN</button>
        <button class="btn" onclick="openMod('settings-mod')">7. [SYSTEM] SETTINGS/STATS</button>
        <button class="btn" onclick="closeMenu()" style="border-color:gray; color:gray;">[ CLOSE ]</button>
    </div>
</div>

<div id="dm-mod" class="module-window"><span class="close-mod" onclick="closeMod('dm-mod')">√ó</span>
    <h3>[ ENCRYPTED_DMS ]</h3>
    <input id="dm-target" placeholder="Recipient...">
    <textarea id="dm-text" placeholder="Message..."></textarea>
    <button class="btn" onclick="sendDM()">SEND</button>
    <div id="dm-list" style="margin-top:20px;"></div>
</div>

<div id="forest-mod" class="module-window"><span class="close-mod" onclick="closeMod('forest-mod')">√ó</span>
    <h3>[ FOREST_NODES ]</h3>
    <input id="f-name" placeholder="Forest Name...">
    <button class="btn" onclick="createForest()">CREATE_FOREST</button>
    <div id="forest-list" style="margin-top:20px;"></div>
</div>

<div id="search-mod" class="module-window"><span class="close-mod" onclick="closeMod('search-mod')">√ó</span>
    <h3>[ ENTITY_SEARCH ]</h3>
    <input id="search-input" placeholder="Enter username..." oninput="doSearch()">
    <div id="search-results"></div>
</div>

<div id="friends-mod" class="module-window"><span class="close-mod" onclick="closeMod('friends-mod')">√ó</span>
    <h3>[ CONTACT_LIST ]</h3>
    <div id="friends-list"></div>
</div>

<div id="self-mod" class="module-window"><span class="close-mod" onclick="closeMod('self-mod')">√ó</span>
    <h3>[ PERSONAL_DATA ]</h3>
    <div id="self-data"></div>
    <textarea id="bio-input" placeholder="Bio..."></textarea>
    <button class="btn" onclick="saveBio()">SAVE_BIO</button>
</div>

<div id="other-mod" class="module-window"><span class="close-mod" onclick="closeMod('other-mod')">√ó</span>
    <h3>[ RECON_DATA ]</h3>
    <input id="recon-target" placeholder="Username...">
    <button class="btn" onclick="reconUser()">SCAN</button>
    <div id="recon-result"></div>
</div>

<div id="settings-mod" class="module-window"><span class="close-mod" onclick="closeMod('settings-mod')">√ó</span>
    <h3>[ SYSTEM_STATS ]</h3>
    <button class="btn" onclick="toggleTheme()">TOGGLE_VISUALS</button>
    <button class="btn" onclick="playLaugh()">LAUGH_PROTOCOL</button>
    <div id="stats-area" style="margin-top:20px;"></div>
</div>

<div id="auth-screen">
    <div class="menu-box">
        <h2 style="text-align:center;">WILDLIFE_OS</h2>
        <input id="u" placeholder="USERNAME"><input id="p" type="password" placeholder="PASSWORD">
        <div id="signup-extra"><input id="d" type="date"></div>
        <button class="btn" onclick="handleAuth()">INITIALIZE</button>
        <p onclick="toggleAuth()" style="font-size:0.7rem; text-align:center; cursor:pointer;">Toggle Login/Signup</p>
    </div>
</div>

<div id="main-ui" style="display:none;"><div id="feed"></div></div>
<button style="position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%; border:1px solid var(--border); background:#000; color:var(--text); cursor:pointer; font-size:30px;" onclick="addPost()">+</button>

<script>
    const BIN_ID = '69609cd1ae596e708fcf605f', KEY = '$2a$10$sGFP1dkFd/v7sGKtbL3XLOYw0jsKRMUNIgsTU/iwij0XnwUAeJPWy';
    let db = { posts: [], accounts: [], dms: [], forests: [] }, me = null, isLogin = false, sessionStart = Date.now();

    const AI_SHIELD = (t) => !["badword", "bully", "mean", "hate", "inappropriate"].some(w => t.toLowerCase().includes(w));

    async function sync() { const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: {'X-Master-Key': KEY, 'X-Bin-Meta': 'false'}}); db = await r.json(); }
    async function save() { await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers: {'Content-Type': 'application/json', 'X-Master-Key': KEY}, body: JSON.stringify(db)}); }

    function toggleAuth() { isLogin = !isLogin; document.getElementById('signup-extra').style.display = isLogin ? 'none' : 'block'; }
    
    async function handleAuth() {
        const user = document.getElementById('u').value.trim(), pass = document.getElementById('p').value;
        await sync();
        if(isLogin) { me = db.accounts.find(a => a.user === user && a.pass === pass); if(!me) return alert("FAIL"); }
        else {
            const age = Math.floor((new Date() - new Date(document.getElementById('d').value)) / 31557600000);
            if(age < 13 || age > 16) return alert("AGE_GATE");
            me = { user, pass, bio: "User.", friends: [], joined: Date.now(), totalTime: 0 };
            db.accounts.push(me); await save();
        }
        localStorage.setItem('jungle_v5', JSON.stringify(me)); location.reload();
    }

    function openMenu() { document.getElementById('command-center').style.display='flex'; }
    function closeMenu() { document.getElementById('command-center').style.display='none'; }
    function openMod(id) { 
        closeMenu(); document.getElementById(id).style.display='block'; 
        if(id === 'dm-mod') renderDMs();
        if(id === 'forest-mod') renderForests();
        if(id === 'friends-mod') renderFriends();
        if(id === 'self-mod') { document.getElementById('self-data').innerHTML = `<b>${me.user}</b><br>Joined: ${new Date(me.joined).toLocaleDateString()}`; document.getElementById('bio-input').value = me.bio; }
        if(id === 'settings-mod') renderStats();
    }
    function closeMod(id) { document.getElementById(id).style.display='none'; }

    function renderStats() {
        const session = Math.floor((Date.now() - sessionStart) / 1000);
        document.getElementById('stats-area').innerHTML = `<div class="stat-line">SESSION_TIME: ${session}s</div><div class="stat-line">TOTAL_WEEKLY_TIME: ${me.totalTime + session}s</div><div class="stat-line">STATUS: ${me.user === 'mjmc50' ? 'ADMIN_ROOT' : 'STANDARD_USER'}</div>`;
    }

    async function addPost() {
        const t = prompt("Title:"), u = prompt("Drive URL:");
        if(t && u && AI_SHIELD(t)) {
            db.posts.unshift({ id: Date.now(), author: me.user, title: t, url: u, comments: [], likes: 0, dislikes: 0, stars: 0 });
            await save(); renderFeed();
        }
    }

    async function interact(id, type) {
        const p = db.posts.find(x => x.id === id);
        if(type === 'like') p.likes++; if(type === 'dis') p.dislikes++; if(type === 'star') p.stars++;
        renderFeed(); await save();
    }

    async function postComment(postId, input) {
        if(!AI_SHIELD(input.value)) return alert("AI_REJECTED");
        const p = db.posts.find(x => x.id === postId); if(!p.comments) p.comments = [];
        p.comments.push(`${me.user}: ${input.value}`); await save(); input.value = ""; renderFeed();
    }

    async function erase(id) { if(confirm("ADMIN_ERASE?")) { db.posts = db.posts.filter(p => p.id !== id); await save(); renderFeed(); } }

    function renderFeed() {
        document.getElementById('feed').innerHTML = db.posts.map(p => `
            <div class="card">
                <small>${p.author}</small> | <span class="star">‚òÖ ${p.stars || 0}</span><br>
                <a href="${p.url}" target="_blank" style="color:var(--glow)">‚ñ∂ VIEW_LOG</a>
                <h3>${p.title}</h3>
                <div style="display:flex; gap:10px;">
                    <button class="btn" onclick="interact(${p.id}, 'like')">üëç ${p.likes || 0}</button>
                    <button class="btn" onclick="interact(${p.id}, 'dis')">üëé ${p.dislikes || 0}</button>
                    <button class="btn" onclick="interact(${p.id}, 'star')">STAR</button>
                </div>
                ${me.user === 'mjmc50' ? `<button class="btn admin-erase" onclick="erase(${p.id})">ERASE_DATA</button>` : ''}
                <div style="margin-top:10px; border-top:1px solid var(--dim); padding-top:10px;">
                    <input placeholder="Add comment..." onkeydown="if(event.key==='Enter') postComment(${p.id}, this)">
                    <div style="font-size:0.7rem; color:gray;">${(p.comments || []).slice(-3).map(c => `<div>> ${c}</div>`).join('')}</div>
                </div>
            </div>`).join('');
    }

    // OTHER MODULES LOGIC
    async function saveBio() { const b = document.getElementById('bio-input').value; if(AI_SHIELD(b)) { db.accounts.find(a => a.user === me.user).bio = b; me.bio = b; localStorage.setItem('jungle_v5', JSON.stringify(me)); await save(); alert("SAVED"); }}
    async function createForest() { const n = document.getElementById('f-name').value; if(AI_SHIELD(n)) { db.forests.push({ name: n, creator: me.user }); await save(); renderForests(); }}
    function renderForests() { document.getElementById('forest-list').innerHTML = db.forests.map(f => `<div class="stat-line">üå≤ ${f.name}</div>`).join(''); }
    function doSearch() { const v = document.getElementById('search-input').value.toLowerCase(); document.getElementById('search-results').innerHTML = db.accounts.filter(a => a.user.toLowerCase().includes(v)).map(r => `<div class="stat-line">${r.user} <button onclick="addFriend('${r.user}')">+</button></div>`).join(''); }
    async function addFriend(n) { const a = db.accounts.find(x => x.user === me.user); if(!a.friends.includes(n)) { a.friends.push(n); me.friends = a.friends; await save(); alert("ADDED"); }}
    function renderFriends() { document.getElementById('friends-list').innerHTML = me.friends.map(f => `<div class="stat-line">${f}</div>`).join(''); }
    function reconUser() { const u = db.accounts.find(x => x.user === document.getElementById('recon-target').value); document.getElementById('recon-result').innerHTML = u ? `<div class="card">${u.user}<br>Bio: ${u.bio}</div>` : 'NOT_FOUND'; }
    async function sendDM() { const t = document.getElementById('dm-target').value, m = document.getElementById('dm-text').value; if(AI_SHIELD(m)) { db.dms.push({ from: me.user, to: t, text: m }); await save(); renderDMs(); }}
    function renderDMs() { document.getElementById('dm-list').innerHTML = db.dms.filter(d => d.to === me.user || d.from === me.user).map(d => `<div class="stat-line"><b>${d.from}:</b> ${d.text}</div>`).join(''); }
    function toggleTheme() { document.body.classList.toggle('theme-white'); }
    function playLaugh() { new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3').play(); }

    window.onload = async () => {
        const saved = localStorage.getItem('jungle_v5');
        if(saved) {
            me = JSON.parse(saved); document.getElementById('auth-screen').style.display = 'none'; document.getElementById('main-ui').style.display = 'block';
            await sync(); renderFeed();
            setInterval(async () => { let a = db.accounts.find(x => x.user === me.user); a.totalTime++; await save(); }, 60000);
        }
    }
</script>
</body>
</html>
