<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TigerStream - AI YouTube Jungle</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    
    <style>
        :root { --tiger-orange: #ff8c00; --tiger-black: #000000; --stripe: #1a1a1a; }
        body { margin: 0; background: var(--tiger-black); color: white; font-family: 'Arial Black', sans-serif; height: 100vh; overflow: hidden; }
        
        /* Original Tiger ID Login Screen */
        #authOverlay { position: fixed; inset: 0; background: black; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: #222; border: 6px solid var(--tiger-orange); padding: 40px; border-radius: 20px; text-align: center; width: 400px; }
        .auth-box input { width: 100%; padding: 10px; margin: 10px 0; border: 2px solid var(--tiger-orange); background: #111; color: white; }

        nav { height: 60px; background: var(--tiger-orange); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 4px solid #000; }
        .split-container { display: flex; height: calc(100vh - 60px); }
        .column { flex: 1; border-right: 4px solid var(--tiger-orange); overflow-y: auto; padding: 20px; background: rgba(0,0,0,0.8); }
        .card { background: #111; border: 3px solid var(--tiger-orange); border-radius: 15px; margin-bottom: 25px; overflow: hidden; }
        
        .post-btn { background: var(--tiger-orange); border: none; padding: 12px 20px; cursor: pointer; font-weight: bold; border-radius: 8px; }
        .fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; font-size: 30px; box-shadow: 0 0 15px var(--tiger-orange); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
        .modal-box { background: #222; border: 5px solid var(--tiger-orange); padding: 30px; width: 400px; border-radius: 20px; text-align: center; }
        iframe { width: 100%; aspect-ratio: 16/9; border: none; }
    </style>
</head>
<body>

<div id="authOverlay">
    <div class="auth-box">
        <h1 style="color:var(--tiger-orange)">TIGER ID</h1>
        <p>Create an account to enter the jungle.</p>
        <input type="text" id="regUser" placeholder="Username">
        <input type="password" id="regPass" placeholder="Password">
        <button class="post-btn" style="width:100%" onclick="registerDevice()">ENTER JUNGLE</button>
    </div>
</div>

<nav>
    <div style="color:black; font-size:1.5rem;"><strong>üêÖ TIGERSTREAM</strong></div>
    <div id="userTag" style="color:black; background:white; padding:5px 10px; border-radius:5px;">USER</div>
</nav>

<div class="split-container">
    <div class="column" id="videoFeed"><h3>JUNGLE FEED</h3></div>
</div>

<button class="post-btn fab" onclick="openModal()">+</button>
<video id="aiProcessor" style="display:none;" muted></video>

<div id="uploadModal" class="modal">
    <div class="modal-box">
        <h2 style="color:var(--tiger-orange)">AI GATEKEEPER</h2>
        <div id="aiStatus" style="color:#ffcc00; margin-bottom:10px;">Waiting for video...</div>
        <input type="file" id="fileIn" accept="video/*" onchange="runAI()">
        <input type="text" id="titleIn" placeholder="Post Title...">
        <button id="finalPostBtn" class="post-btn" style="width:100%;" onclick="startUpload()" disabled>SCANNING REQUIRED</button>
        <button onclick="closeModal()" style="background:none; color:grey; border:none; margin-top:10px; cursor:pointer;">Cancel</button>
    </div>
</div>

<script>
    const CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com'; 
    let contentStore = JSON.parse(localStorage.getItem('tiger_yt_posts')) || [];
    let userAccount = JSON.parse(localStorage.getItem('tiger_account')) || null;
    let model = null;

    // Load AI
    cocoSsd.load().then(res => { model = res; document.getElementById('aiStatus').innerText = "AI Online: Ready to scan."; });

    // Handle Tiger ID Login
    window.onload = () => {
        if (userAccount) {
            document.getElementById('authOverlay').style.display = 'none';
            document.getElementById('userTag').innerText = userAccount.username.toUpperCase();
        }
        gapi.load('client', () => { gapi.client.init({ clientId: CLIENT_ID, scope: 'https://www.googleapis.com/auth/youtube.upload' }); });
        renderFeed();
    };

    function registerDevice() {
        const u = document.getElementById('regUser').value.trim();
        const p = document.getElementById('regPass').value;
        if (u && p) {
            userAccount = { username: u, password: p };
            localStorage.setItem('tiger_account', JSON.stringify(userAccount));
            location.reload();
        }
    }

    function openModal() { document.getElementById('uploadModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('uploadModal').style.display = 'none'; }

    // AI SCANNING
    async function runAI() {
        const file = document.getElementById('fileIn').files[0];
        const status = document.getElementById('aiStatus');
        const btn = document.getElementById('finalPostBtn');
        if (!file) return;

        status.innerText = "AI SCANNING CONTENT...";
        const videoElement = document.getElementById('aiProcessor');
        videoElement.src = URL.createObjectURL(file);
        
        videoElement.onloadeddata = async () => {
            videoElement.currentTime = 1;
            setTimeout(async () => {
                const predictions = await model.detect(videoElement);
                // Rule: Must detect an "animal" or "object", but no "person" for a wild jungle feel
                const isSafe = !predictions.some(p => p.class === "person");

                if (isSafe) {
                    status.innerText = "AI PASSED: CONTENT IS SAFE";
                    status.style.color = "#00ff00";
                    btn.disabled = false;
                    btn.innerText = "LOG IN TO GOOGLE & POST";
                } else {
                    status.innerText = "AI REJECTED: HUMAN DETECTED";
                    status.style.color = "red";
                }
            }, 500);
        };
    }

    // YOUTUBE UPLOAD
    function startUpload() {
        const client = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: 'https://www.googleapis.com/auth/youtube.upload',
            callback: (res) => { if (res.access_token) performUpload(res.access_token); },
        });
        client.requestAccessToken();
    }

    async function performUpload(token) {
        const file = document.getElementById('fileIn').files[0];
        const title = document.getElementById('titleIn').value || "TigerStream Hunt";
        const formData = new FormData();
        formData.append('metadata', new Blob([JSON.stringify({
            snippet: { title: title, categoryId: '22' },
            status: { privacyStatus: 'unlisted', embeddable: true }
        })], { type: 'application/json' }));
        formData.append('file', file);

        const res = await fetch('https://www.googleapis.com/upload/youtube/v3/videos?uploadType=multipart&part=snippet,status', {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + token },
            body: formData
        });
        const data = await res.json();
        if (data.id) {
            contentStore.unshift({ id: Date.now(), ytId: data.id, title: title, author: userAccount.username });
            localStorage.setItem('tiger_yt_posts', JSON.stringify(contentStore));
            renderFeed();
            closeModal();
        }
    }

    function renderFeed() {
        const feed = document.getElementById('videoFeed');
        feed.innerHTML = '<h3>JUNGLE FEED</h3>';
        contentStore.forEach(post => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <iframe src="https://www.youtube.com/embed/${post.ytId}?origin=${window.location.origin}&rel=0" allowfullscreen></iframe>
                <div style="padding:15px;">
                    <h4>${post.title}</h4>
                    <small>Hunted by: ${post.author}</small>
                </div>`;
            feed.appendChild(card);
        });
    }
</script>
</body>
</html>
