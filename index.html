<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TigerStream | Auto-Jungle</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --tiger: #ff8c00; --bg: #0a0a0a; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Arial Black', sans-serif; }
        nav { background: var(--tiger); padding: 15px; display: flex; justify-content: space-between; color: black; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 600px; margin: auto; padding: 20px; }
        .card { background: #161616; border: 2px solid #222; border-radius: 15px; margin-bottom: 30px; overflow: hidden; }
        iframe { width: 100%; aspect-ratio: 16/9; border: none; }
        .content { padding: 15px; }
        .star { cursor: pointer; font-size: 1.5rem; color: #333; }
        .star.active { color: var(--tiger); }
        .comment-box { background: #000; padding: 10px; border-radius: 8px; margin-top: 10px; }
        input[type="text"] { width: 100%; padding: 10px; background: #111; color: white; border: 1px solid #333; border-radius: 5px; box-sizing: border-box; }
        .fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--tiger); border: none; font-size: 30px; cursor: pointer; }
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
        .modal-ui { background: #222; padding: 30px; border-radius: 20px; width: 320px; text-align: center; border: 3px solid var(--tiger); }
    </style>
</head>
<body>

<nav>
    <strong>üêÖ TIGERSTREAM</strong>
    <span id="aiStat" style="font-size: 10px; background: black; color: var(--tiger); padding: 4px 8px; border-radius: 10px;">LOADING AI...</span>
</nav>

<div class="container" id="feed">Loading Jungle...</div>

<button class="fab" onclick="document.getElementById('modal').style.display='flex'">+</button>

<div id="modal">
    <div class="modal-ui">
        <h2 style="color:var(--tiger)">AUTO-POST</h2>
        <input type="file" id="vidIn" accept="video/*" onchange="autoProcess()">
        <input type="text" id="titleIn" placeholder="Title...">
        <div id="status" style="margin: 15px 0; font-size: 12px; color: #888;">Select a video to begin.</div>
        <button id="mainBtn" style="display:none; background:var(--tiger); border:none; padding:10px; width:100%; font-weight:bold; cursor:pointer;" onclick="startAuth()">LOGIN & POST</button>
        <button onclick="document.getElementById('modal').style.display='none'" style="background:none; border:none; color:grey; margin-top:10px; cursor:pointer;">Cancel</button>
    </div>
</div>

<video id="processor" style="display:none;" muted></video>

<script>
    const BIN_ID = '6960939543b1c97be9237b80'; 
    const API_KEY = '$2a$10$sGFP1dkFd/v7sGKtbL3XLOYw0jsKRMUNIgsTU/iwij0XnwUAeJPWy'; 
    const CLIENT_ID = 'PASTE_YOUR_GOOGLE_ID_HERE'; // MUST BE ADDED
    const BANNED = ['badword1', 'badword2']; // Add words here

    let model, jungleData = { posts: [] };

    window.onload = async () => {
        model = await cocoSsd.load();
        document.getElementById('aiStat').innerText = "AI ACTIVE";
        refresh();
    };

    async function refresh() {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { 'X-Master-Key': API_KEY } });
        const json = await res.json();
        jungleData = json.record;
        render();
    }

    async function autoProcess() {
        const file = document.getElementById('vidIn').files[0];
        const status = document.getElementById('status');
        if (!file) return;

        status.innerText = "AI SCANNING...";
        const vid = document.getElementById('processor');
        vid.src = URL.createObjectURL(file);
        
        vid.onloadeddata = async () => {
            vid.currentTime = 1;
            setTimeout(async () => {
                const results = await model.detect(vid);
                const isHuman = results.some(p => p.class === 'person');
                if (isHuman) {
                    status.innerText = "‚ùå REJECTED: HUMAN DETECTED";
                    status.style.color = "red";
                } else {
                    status.innerText = "‚úÖ PASSED: JUNGLE CERTIFIED";
                    status.style.color = "lime";
                    document.getElementById('mainBtn').style.display = 'block';
                }
            }, 1000);
        };
    }

    function startAuth() {
        google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: 'https://www.googleapis.com/auth/youtube.upload',
            callback: (res) => { if (res.access_token) upload(res.access_token); }
        }).requestAccessToken();
    }

    async function upload(token) {
        document.getElementById('status').innerText = "UPLOADING...";
        const file = document.getElementById('vidIn').files[0];
        const title = filter(document.getElementById('titleIn').value || "Jungle Clip");

        const meta = { snippet: { title: title }, status: { privacyStatus: 'unlisted' } };
        const fd = new FormData();
        fd.append('metadata', new Blob([JSON.stringify(meta)], { type: 'application/json' }));
        fd.append('file', file);

        const res = await fetch('https://www.googleapis.com/upload/youtube/v3/videos?uploadType=multipart&part=snippet,status', {
            method: 'POST', headers: { 'Authorization': `Bearer ${token}` }, body: fd
        });
        const data = await res.json();
        
        if (data.id) {
            jungleData.posts.unshift({ id: data.id, title: title, rating: 0, comments: [] });
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
                body: JSON.stringify(jungleData)
            });
            location.reload(); // Auto-refresh everything
        }
    }

    function filter(t) {
        BANNED.forEach(w => t = t.replace(new RegExp(w, 'gi'), 'üåø'));
        return t;
    }

    function render() {
        document.getElementById('feed').innerHTML = jungleData.posts.map(p => `
            <div class="card">
                <iframe src="https://www.youtube.com/embed/${p.id}"></iframe>
                <div class="content">
                    <h3>${p.title}</h3>
                    <div>${[1,2,3,4,5].map(n => `<span class="star ${n<=p.rating?'active':''}" onclick="rate('${p.id}',${n})">‚òÖ</span>`).join('')}</div>
                    <div class="comment-box">
                        ${p.comments.map(c => `<div style="font-size:12px; margin-bottom:5px;">üêÖ ${c}</div>`).join('')}
                        <input type="text" placeholder="Add comment..." onkeydown="if(event.key==='Enter') comment('${p.id}',this)">
                    </div>
                </div>
            </div>
        `).join('');
    }

    async function rate(id, v) {
        jungleData.posts.find(p => p.id === id).rating = v;
        update();
    }

    async function comment(id, el) {
        jungleData.posts.find(p => p.id === id).comments.push(filter(el.value));
        update();
    }

    async function update() {
        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
            method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
            body: JSON.stringify(jungleData)
        });
        render();
    }
</script>
</body>
</html>
